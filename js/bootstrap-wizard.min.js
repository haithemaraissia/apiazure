(function(n){n.fn.wizard=function(n){return new Wizard(this,n)};n.fn.wizard.logging=!1;var t=function(n,t,i,r,u){this.wizard=n;this.index=i;this.prev=r;this.next=u;this.el=t;this.title=t.find("h3").first().text();this.name=t.data("cardname")||this.title;this.nav=this._createNavElement(this.title,i);this._disabled=!1;this._loaded=!1;this._events={}};t.prototype={select:function(){this.log("selecting");this.isSelected()||(this.nav.addClass("active"),this.el.show(),this._loaded||(this.trigger("loaded"),this.reload()),this.trigger("selected"));var n=this.wizard;return n.backButton.toggleClass("disabled",this.index==0),this.index>=n._cards.length-1?(this.log("on last card, changing next button to submit"),n.changeNextButton(n.args.buttons.submitText,"btn-success"),n._readyToSubmit=!0,n.trigger("readySubmit")):(n._readyToSubmit=!1,n.changeNextButton(n.args.buttons.nextText,"btn-wizard")),this},_createNavElement:function(t,i){var u=n('<li class="wizard-nav-item"><\/li>'),r=n('<a class="wizard-nav-link"><\/a>');return r.data("navindex",i),u.append(r),r.append('<span class="glyphicon glyphicon-chevron-right"><\/span> '),r.append(t),u},markVisited:function(){return this.log("marking as visited"),this.nav.addClass("already-visited"),this.trigger("markVisited"),this},unmarkVisited:function(){return this.log("unmarking as visited"),this.nav.removeClass("already-visited"),this.trigger("unmarkVisited"),this},deselect:function(){return this.nav.removeClass("active"),this.el.hide(),this.trigger("deselect"),this},enable:function(){return this.log("enabling"),this.nav.addClass("active"),this._disabled=!1,this.trigger("enabled"),this},disable:function(n){return this.log("disabling"),this._disabled=!0,this.nav.removeClass("active already-visited"),n&&this.el.hide(),this.trigger("disabled"),this},isDisabled:function(){return this._disabled},alreadyVisited:function(){return this.nav.hasClass("already-visited")},isSelected:function(){return this.nav.hasClass("active")},reload:function(){return this._loaded=!0,this.trigger("reload"),this},on:function(){return this.wizard.on.apply(this,arguments)},trigger:function(){return this.callListener("on"+arguments[0]),this.wizard.trigger.apply(this,arguments)},toggleAlert:function(t,i){this.log("toggling alert to: "+i);i=typeof i=="undefined"?!0:i;i?this.trigger("showAlert"):this.trigger("hideAlert");var r,u=this.el.children("h3").first().next("div.alert");if(u.length==0){if(!i)return this;this.log("couldn't find existing alert div, creating one");r=n("<div />");r.addClass("alert");r.addClass("hide");r.insertAfter(this.el.find("h3").first())}else this.log("found existing alert div"),r=u.first();return i?(t!=null&&(this.log("setting alert msg to",t),r.html(t)),r.show()):r.hide(),this},callListener:function(n){var t,i,r;if(n=n.toLowerCase(),this.log("looking for listener "+n),t=window[this.el.data(n)],t){this.log("calling listener "+n);i=this.wizard;try{r=t(this)}catch(u){this.log("exception calling listener "+n+": ",u)}}else this.log("didn't find listener "+n)},problem:function(n){this.nav.find("a").toggleClass("wizard-step-error",n)},validate:function(){var t=!1,e=this,u,i,r,f;return this.el.find("[data-validate]").each(function(i,r){var f,u,o;if(e.log("validating individiual inputs"),r=n(r),f=r.data("validate"),f)if(u={status:!0,title:"Error",msg:""},o=window[f](r),n.extend(u,o),n("#btn-"+r.attr("id")).length===1&&(r=n("#btn-"+r.attr("id"))),u.status){r.parents("div.form-group").toggleClass("has-error",!1);n("#btn-"+r.attr("id")).length===1&&(r=n("#btn-"+r.attr("id")));try{r.popover("destroy")}catch(s){r.popover("hide")}}else t=!0,r.parents("div.form-group").toggleClass("has-error",!0),n("#btn-"+r.attr("id")).length===1&&(r=n("#btn-"+r.attr("id"))),e.wizard.errorPopover(r,u.msg)}),this.log("after validating inputs, failures is",t),u=window[this.el.data("validate")],u&&(this.log("running html-embedded card validator"),i=u(this),(typeof i=="undefined"||i==null)&&(i=!0),i||(t=!0),this.log("after running html-embedded card validator, failures is",t)),this.log("running listener validator"),r=this.trigger("validate"),(typeof r=="undefined"||r==null)&&(r=!0),r||(t=!0),this.log("after running listener validator, failures is",t),f=!t,f?(this.log("validated, calling listeners"),this.trigger("validated")):(this.log("invalid"),this.trigger("invalid")),f},log:function(){if(window.console&&n.fn.wizard.logging){var i="card '"+this.name+"': ",t=[i];t.push.apply(t,arguments);console.log.apply(console,t)}},isActive:function(){return this.nav.hasClass("active")}};Wizard=function(t,i){this.wizard_template=['<div  class="modal fade wizard">','<div class="modal-dialog wizard-dialog">','<div class="modal-content wizard-content">','<div class="modal-header wizard-header">','<button type="button" class="close wizard-close" aria-hidden="true">&times;<\/button>','<h3 class="modal-title wizard-title"><\/h3>','<span class="wizard-subtitle"><\/span>',"<\/div>",'<div class="modal-body wizard-body">','<div class="pull-left wizard-steps">','<div class="wizard-nav-container">','<ul class="nav wizard-nav-list">',"<\/ul>","<\/div>",'<div class="wizard-progress-container">','<div class="progress progress-striped">','<div class="progress-bar" style="width: 0%;"><\/div>',"<\/div>","<\/div>","<\/div>","<form>",'<div class="wizard-cards">','<div class="wizard-card-container">',"<\/div>",'<div class="wizard-footer">','<div class="wizard-buttons-container">','<button class="btn wizard-cancel wizard-close" type="button">Cancel<\/button>','<div class="btn-group-single pull-right">','<button class="btn wizard-back" type="button">Back<\/button>','<button class="btn btn-wizard wizard-next" type="button">Next<\/button>',"<\/div>","<\/div>","<\/div>","<\/div>","<\/form>","<\/div>","<\/div>","<\/div>","<\/div>"];this.args={keyboard:!0,backdrop:!0,show:!1,submitUrl:"",showCancel:!1,showClose:!0,progressBarCurrent:!1,increaseHeight:0,contentHeight:300,contentWidth:580,buttons:{cancelText:"Cancel",nextText:"Next",backText:"Back",submitText:"Submit",submittingText:"Submitting..."},formClass:"form-horizontal"};n.extend(this.args,i||{});this._create(t)};Wizard.prototype={log:function(){if(window.console&&n.fn.wizard.logging){var i="wizard "+this.el.id+": ",t=[i];t.push.apply(t,arguments);console.log.apply(console,t)}},_create:function(t){this.markup=n(t);this.title=this.markup.data("title");this.submitCards=this.markup.find(".wizard-error,.wizard-failure,.wizard-success,.wizard-loading");this.el=n(this.wizard_template.join("\n"));n("body").append(this.el);this.modal=this.el.modal({keyboard:this.args.keyboard,show:this.args.show,backdrop:this.args.backdrop});this.dimensions={contentHeight:this.args.contentHeight,contentWidth:this.args.contentWidth};this.dialog=this.modal.find(".wizard-dialog");this.content=this.modal.find(".wizard-content");this.header=this.modal.find(".wizard-header");this.body=this.modal.find(".wizard-body");this.wizardSteps=this.modal.find(".wizard-steps");this.wizardCards=this.modal.find(".wizard-cards");this.wizardCardContainer=this.modal.find(".wizard-card-container");this.wizardCardContainer.append(this.markup.find(".wizard-card")).append(this.submitCards);this.navContainer=this.modal.find(".wizard-nav-container");this.navList=this.modal.find(".wizard-nav-list");this.progressContainer=this.modal.find(".wizard-progress-container");this.progress=this.progressContainer.find(".progress-bar");this.closeButton=this.modal.find("button.wizard-close.close");this.cardsContainer=this.modal.find("wizard-cards-container");this.form=this.modal.find("form");this.footer=this.modal.find(".wizard-footer");this.cancelButton=this.footer.find(".wizard-cancel");this.backButton=this.footer.find(".wizard-back");this.nextButton=this.footer.find(".wizard-next");this._cards=[];this.cards={};this._readyToSubmit=!1;this.percentComplete=0;this._submitting=!1;this._events={};this._firstShow=!0;this._createCards();this.nextButton.click(this,this._handleNextClick);this.backButton.click(this,this._handleBackClick);this.cancelButton.text(this.args.buttons.cancelText);this.backButton.text(this.args.buttons.backText);this.nextButton.text(this.args.buttons.nextText);this.form.addClass(this.args.formClass);this.popovers=[];var i=this,r=function(){i.reset();i.close();i.trigger("closed")};this.closeButton.click(r);this.cancelButton.click(r);this.wizardSteps.on("click","li.already-visited a.wizard-nav-link",this,function(t){var i=parseInt(n(t.target).data("navindex"));t.data.setCard(i)});this.title.length!=0&&this.setTitle(this.title);this.on("submit",this._defaultSubmit);this.autoDimensions()},autoDimensions:function(){this.modal.css("display","block");this.dimensions.header=this.header.outerHeight(!0);this.dimensions.navigation=this.wizardSteps.outerHeight(!0);this.dimensions.navigation<this.dimensions.contentHeight&&(this.dimensions.navigation=this.dimensions.contentHeight,this.navContainer.height(this.dimensions.contentHeight-60-this.progressContainer.outerHeight(!0)));this.dimensions.body=this.dimensions.navigation-30;this.wizardSteps.height(this.dimensions.body);this.dimensions.modal=this.dimensions.header+this.dimensions.navigation-30;this.content.height(this.dimensions.modal+"px");this.dialog.width(this.dimensions.contentWidth);this.body.height(this.dimensions.body+"px");this.wizardCards.height(this.dimensions.body+"px");this.dimensions.footer=this.footer.outerHeight(!0);this.dimensions.cardContainer=this.dimensions.body-this.dimensions.footer;this.wizardCardContainer.height(this.dimensions.cardContainer);this.dimensions.offset=(n(window).height()-this.dialog.height())/2;this.dimensions.offset=this.dimensions.offset+20;this.dialog.css({"margin-top":this.dimensions.offset+"px","padding-top":0});this.modal.css("display","")},setTitle:function(n){return this.log("setting title to",n),this.modal.find(".wizard-title").first().text(n),this},setSubtitle:function(n){return this.log("setting subtitle to",n),this.modal.find(".wizard-subtitle").first().text(n),this},errorPopover:function(n,t,i){this.log("launching popover on",n);i=typeof i!="undefined"?i:!1;var r=n.popover({content:t,trigger:"manual",html:i,container:n.parents(".form-group")}).addClass("error-popover").popover("show").next(".popover");return n.parents(".form-group").find(".popover").addClass("error-popover"),this.popovers.push(n),r},destroyPopover:function(t){t=n(t);try{t.popover("destroy")}catch(i){t.popover("hide")}},hidePopovers:function(){this.log("hiding all popovers");var t=this;n.each(this.popovers,function(n,i){t.destroyPopover(i)});this.modal.find(".has-error").removeClass("has-error");this.popovers=[]},eachCard:function(t){return n.each(this._cards,t),this},getActiveCard:function(){this.log("getting active card");var t=null;return n.each(this._cards,function(n,i){if(i.isActive())return t=i,!1}),t?this.log("found active card",t):this.log("couldn't find an active card"),t},changeNextButton:function(n,t){return this.log("changing next button, text: "+n,"class: "+t),typeof t!="undefined"&&this.nextButton.removeClass("btn-success btn-wizard"),t&&this.nextButton.addClass(t),this.nextButton.text(n),this},hide:function(){return this.log("hiding"),this.modal.modal("hide"),this},close:function(){return this.log("closing"),this.modal.modal("hide"),this},show:function(){return this.log("showing"),this._firstShow&&(this.setCard(0),this._firstShow=!1),this.args.showCancel?this.cancelButton.show():this.cancelButton.hide(),this.args.showClose&&this.closeButton.show(),this.modal.modal("show"),this},on:function(n,t){return this.log("adding listener to event "+n),this._events[n]=t,this},trigger:function(){var n=arguments[0],i=Array.prototype.slice.call(arguments),t,r;if(i.shift(),i.unshift(this),this.log("firing event "+n),t=this._events[n],t===undefined&&this.wizard!==undefined&&(t=this.wizard._events[n]),r=null,typeof t=="function"){this.log("found event handler, calling "+n);try{r=t.apply(this,i)}catch(u){this.log("event handler "+n+" had an exception")}}else this.log("couldn't find an event handler for "+n);return r},reset:function(){return this.log("resetting"),this.updateProgressBar(0),this.hideSubmitCards(),this.setCard(0),this.lockCards(),this.enableNextButton(),this.showButtons(),this.hidePopovers(),this.trigger("reset"),this},_abstractIncrementStep:function(n,t){var r=this.getActiveCard(),i;if(r)for(this.log("searching for valid next card");;)if(i=t(r),i)if(this.log("looking at card",i.index),i.isDisabled()){this.log("card "+i.index+" is disabled/locked, continuing");r=i;continue}else return this.setCard(r.index+n);else{this.log("next card is not defined, breaking");break}else this.log("current card is undefined")},incrementCard:function(){this.log("incrementing card");var n=this._abstractIncrementStep(1,function(n){return n.next});return this.trigger("incrementCard"),n},decrementCard:function(){this.log("decrementing card");var n=this._abstractIncrementStep(-1,function(n){return n.prev});return this.trigger("decrementCard"),n},setCard:function(n){var i,r,t,u,f;if(this.log("setting card to "+n),this.hideSubmitCards(),i=this.getActiveCard(),this._submitting)return this.log("we're submitting the wizard already, can't change cards"),i;if(r=this._cards[n],r){if(r.isDisabled())return this.log("new card is currently disabled, returning"),i;if(i){if(n>i.index){for(t=i,u=!1;t.index!=r.index;){if(t.index!=i.index&&(t.prev.deselect(),t.prev.markVisited(),t.select()),u=t.validate(),!u)return t;t=t.next}t.prev.deselect();t.prev.markVisited()}i.deselect();i.markVisited()}return r.select(),this.args.progressBarCurrent?(this.percentComplete=n*100/this._cards.length,this.updateProgressBar(this.percentComplete)):(f=this.percentComplete,this.percentComplete=n*100/this._cards.length,this.percentComplete=Math.max(f,this.percentComplete),this.updateProgressBar(this.percentComplete)),r}this.log("couldn't find card "+n)},updateProgressBar:function(n){this.log("updating progress to "+n+"%");this.progress.css({width:n+"%"});this.percentComplete=n;this.trigger("progressBar",n);n==100?(this.log("progress is 100, animating progress bar"),this.progressContainer.find(".progress").addClass("active")):n==0&&(this.log("progress is 0, disabling animation"),this.progressContainer.find(".progress").removeClass("active"))},getNextCard:function(){var n=this.getActiveCard();if(n)return n.next},lockCards:function(){return this.log("locking nav cards"),this.eachCard(function(n,t){t.unmarkVisited()}),this},disableCards:function(){return this.log("disabling all nav cards"),this.eachCard(function(n,t){t.disable()}),this},enableCards:function(){return this.log("enabling all nav cards"),this.eachCard(function(n,t){t.enable()}),this},hideCards:function(){return this.log("hiding cards"),this.eachCard(function(n,t){t.deselect()}),this.hideSubmitCards(),this},hideButtons:function(){return this.log("hiding buttons"),this.cancelButton.hide(),this.closeButton.hide(),this.nextButton.hide(),this.backButton.hide(),this},showButtons:function(){return this.log("showing buttons"),this.args.showCancel?this.cancelButton.show():this.cancelButton.hide(),this.args.showClose&&this.closeButton.show(),this.nextButton.show(),this.backButton.show(),this},getCard:function(t){var r=n(t).parents(".wizard-card").first()[0],i;return r?(i=null,this.eachCard(function(n,t){return r==t.el[0]?(i=t,!1):!0}),i):null},_createCards:function(){var r=null,e=null,i=null,o=this,u=this,f;u.log("Creating Cards");f=this.modal.find(".wizard-cards .wizard-card");n.each(f,function(f,s){s=n(s);r=i;i=new t(o,s,f,r,e);u._cards.push(i);i.name&&(u.cards[i.name]=i);r&&(r.next=i);u.modal.find(".wizard-steps .wizard-nav-list").append(i.nav)})},showSubmitCard:function(n){this.log("showing "+n+" submit card");var t=this.el.find(".wizard-"+n);t.length?(this.hideCards(),this.el.find(".wizard-"+n).show()):this.log("couldn't find submit card "+n)},hideSubmitCard:function(n){this.log("hiding "+n+" submit card");this.el.find(".wizard-"+n).hide()},hideSubmitCards:function(){var t=this;n.each(["success","error","failure","loading"],function(n,i){t.hideSubmitCard(i)})},enableNextButton:function(){return this.log("enabling next button"),this.nextButton.removeAttr("disabled"),this},disableNextButton:function(){return this.log("disabling next button"),this.nextButton.attr("disabled","disabled"),this},serializeArray:function(){var t=this.form.serializeArray();return this.form.find('input[disabled][data-serialize="1"]').each(function(){formObj={name:n(this).attr("name"),value:n(this).val()};t.push(formObj)}),t},serialize:function(){var t=this.form.serialize();return this.form.find('input[disabled][data-serialize="1"]').each(function(){t=t+"&"+n(this).attr("name")+"="+n(this).val()}),t},find:function(n){return this.modal.find(n)},submitSuccess:function(){this.log("submit success");this._submitting=!1;this.showSubmitCard("success");this.trigger("submitSuccess")},submitFailure:function(){this.log("submit failure");this._submitting=!1;this.showSubmitCard("failure");this.trigger("submitFailure")},submitError:function(){this.log("submit error");this._submitting=!1;this.showSubmitCard("error");this.trigger("submitError")},_submit:function(){this.log("submitting wizard");this._submitting=!0;this.lockCards();this.cancelButton.hide();this.closeButton.hide();this.backButton.hide();this.showSubmitCard("loading");this.updateProgressBar(100);this.changeNextButton(this.args.buttons.submittingText,!1);this.disableNextButton();var n=this.trigger("submit");this.trigger("loading")},_onNextClick:function(){this.log("handling 'next' button click");var n=this.getActiveCard();this._readyToSubmit&&n.validate()?this._submit():n=this.incrementCard()},_onBackClick:function(){this.log("handling 'back' button click");var n=this.decrementCard()},_handleNextClick:function(n){var t=n.data;t._onNextClick.call(t)},_handleBackClick:function(n){var t=n.data;t._onBackClick.call(t)},_defaultSubmit:function(t){n.ajax({type:"POST",url:t.args.submitUrl,data:t.serialize(),dataType:"json"}).done(function(){t.submitSuccess();t.hideButtons();t.updateProgressBar(0)}).fail(function(){t.submitFailure();t.hideButtons()})}}})(window.jQuery);
//# sourceMappingURL=bootstrap-wizard.min.js.map
